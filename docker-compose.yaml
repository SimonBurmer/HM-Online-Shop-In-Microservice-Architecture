version: "3"
services:
  # https://docs.docker.com/compose/compose-file/compose-file-v3/#environment
  # Dependencies
  redis:
    image: "redis"
    environment:
      - ALLOW_EMPTY_PASSWORD=yes

  nats:
    image: nats

  # App
  # TODO: EXPOSE IN DOCKERFILE LÃ–schen!
  logger-service:
    build:
      context: .
      dockerfile: logger/Dockerfile
    image: logger
    depends_on:
      - nats 

  customer-service:
    build:
      context: .
      dockerfile: customer/service/Dockerfile
    image: customer
    depends_on:
      - redis
      - nats 

  payment-service:
    build:
      context: .
      dockerfile: payment/service/Dockerfile
    image: payment
    depends_on:
      - redis
      - nats 
          
  client:
    build:
      context: .
      dockerfile: client/service/Dockerfile
    image: client
    depends_on:
      - redis
      - nats
      - customer-service
      - catalog-service
      - stock-service

  catalog-service:
    build:
      context: .
      dockerfile: catalog/service/Dockerfile
    image: catalog
    depends_on:
      - nats 

  stock-service:
    build:
      context: .
      dockerfile: stock/service/Dockerfile
    image: stock
    depends_on:
      - redis
      - nats 